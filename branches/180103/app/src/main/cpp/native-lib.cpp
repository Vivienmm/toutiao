#include <jni.h>
#include <string>

//用户aes加解密秘钥
const char* USER_KEY = "Q2hpbmFzb0AyMDE1";
//发布的app 签名,只有和本签名一致的app 才会返回合法的 授权 key，防止so文件被未知应用盗用
const char* RELEASE_SIGN ="308203733082025ba0030201020204634a04a6300d06092a864886f70d01010b05003069310b300906035504061302434e310f300d06035504080c06e58c97e4baac310f300d06035504070c06e58c97e4baac3110300e060355040a13076368696e61736f31143012060355040b130b6368696e61736f2e636f6d3110300e060355040313076368696e61736f3020170d3135303431313038333335375a180f32313135303331383038333335375a3069310b300906035504061302434e310f300d06035504080c06e58c97e4baac310f300d06035504070c06e58c97e4baac3110300e060355040a13076368696e61736f31143012060355040b130b6368696e61736f2e636f6d3110300e060355040313076368696e61736f30820122300d06092a864886f70d01010105000382010f003082010a0282010100aab8356e6ec372d7c319bc1c49c767b2eb0c2f020fa6d96d06067a7929d8472f2547aad22135297898f6f2aea86177aed607d753961c3f251d5e85e1a36cc03ff20a6a6ab2d6c33081be7b9cc4d56bf62d664561d92bcc113e58c7f54d19eebcdd6fad3c02288f9096c503e28f044783056acd429f2fd80d295fa7b5126df7af377d9a569f2d5a16fcc6ba6bfab64b98f56e914528f11194f4a915d4e8ab0095e5fed1223f0fc993fc14ac185a20ea3e6d0f1170c313283ba33dd32d1d692fce46149a14de04897b1c5cf216db1b0d49ec1be93c0f411c9d1820927df34958e8e281837a0faa4a1b5b756708ffa21a24d84395d48509428795330890473c1e290203010001a321301f301d0603551d0e041604142ddbcc9cd2b6d713036981e6c46d578ca376a178300d06092a864886f70d01010b0500038201010022004c66d0b8ede4762bd02d28a3e4a9c9f116c1f4565c53add89ca059b7e7915cec2e74f6ff2f2c3b4937645f63341cddb3b0671d5f703537048c6816025716424d32532928fe28ce3d7c393d482e0cb3afb64d9864e3bd75a7f46e9e81414352fb78df54396ffbb43efd1da7c3604abbb99522161181f3c3a84e6f3c2e64516b1af26f869717d676358e59d6086a1771256f440ccb0a87acdd8e4b12f7a82f55019e8d7ca2f0f9f0eb05c296b16a7a939e2ba668dc905cf633e4707f0e47737242e4fea6f95ae041247e2950f51b745652dfbfbafd6e646d654846a20ba72e047bd2bd267ea72bd1cdbf4939d41f4ce860396af6ee3e3e1fc25ca5ad1cd1b8";

extern "C"
jstring Java_com_chinaso_toutiao_util_secure_JniUtil_stringFromJNI(
        JNIEnv* env,
        jobject /* this */) {
    std::string hello = "Hello from C++";
    return env->NewStringUTF(hello.c_str());
}

extern "C"
jstring Java_com_chinaso_toutiao_util_secure_JniUtil_getUserKey
        (JNIEnv* env, jobject obj, jstring signStrng) {

    const char *str = (env)->GetStringUTFChars(signStrng, 0);
    int ret=strcmp(str,RELEASE_SIGN);
    env->ReleaseStringUTFChars(signStrng, str);

    return ret==0?(env)->NewStringUTF(USER_KEY):(env)->NewStringUTF("");
}